<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¬¬6èª² å˜èªç·´ç¿’</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    #container {
      background: white;
      padding: 30px;
      max-width: 800px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
    input, button {
      font-size: 16px;
      margin: 10px 0;
    }
    input {
      width: 100%;
      padding: 10px;
    }
    .menu-link {
      display: block;
      text-align: center;
      margin-top: 30px;
    }
    .menu-link a {
      display: inline-block;
      padding: 10px 20px;
      background: #007acc;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: background 0.3s;
    }
    .menu-link a:hover {
      background: #005fa3;
    }
    .progress-bar {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
    }
    .progress-bar span {
      display: inline-block;
      margin: 0 4px;
    }
    .bar {
      width: 100%;
      height: 20px;
      background-color: #eee;
      border: 1px solid #aaa;
      border-radius: 4px;
      margin-top: 5px;
      position: relative;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      background-color: #ccffcc;
      width: 0%;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>ç¬¬6èª² å˜èªç·´ç¿’</h1>
    <button onclick="playVocab()">â–¶ å˜èªã‚’èã</button><br>
    <input type="text" id="answerVocab" placeholder="èãå–ã£ãŸå˜èªã‚’å…¥åŠ›ï¼ˆEnterã§ç­”ãˆåˆã‚ã›ï¼‰" onkeydown="handleKeyDown(event)">
    <button onclick="checkVocab()">ç­”ãˆåˆã‚ã›</button>
    <div id="feedbackVocab"></div>
    <div id="completionMessage"></div>
    <div class="progress-bar">
      æ­£è§£æ•° <span style="color:#32cd32;">â–‡</span> 3å›:<span id="count3">0</span>ã€€
      <span style="color:#64ee64;">â–‡</span> 2å›:<span id="count2">0</span>ã€€
      <span style="color:#a0ffa0;">â–‡</span> 1å›:<span id="count1">0</span>ã€€
      <span style="color:#ffffff;">â–‡</span> 0å›:<span id="count0">0</span>ã€€
      <span style="color:#ffff00;">â–‡</span> å¾©ç¿’:<span id="countReview">0</span>
      <div class="bar"><div id="barFill" class="bar-fill"></div></div>
    </div>
    <div class="menu-link">
      <a href="index.html" style="margin-left: 10px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
    </div>
  </div>

  <audio id="audioPlayer"></audio>
<script>
    const vocabListBase = [
      { jp: "å‹•ç‰©åœ’", cn: "åŠ¨ç‰©å›­" },
      { jp: "é‡‘é­š", cn: "é‡‘é±¼" },
      { jp: "ã‹ã‚ã„ã„", cn: "å¯çˆ±" },
      { jp: "ãƒ‘ãƒ³ãƒ€", cn: "ç†ŠçŒ«" },
      { jp: "ã©ã‚Œãã‚‰ã„", cn: "å¤šå°‘" },
      { jp: "ãŠã‚ˆã", cn: "å¤§çº¦" },
      { jp: "èµ¤ã¡ã‚ƒã‚“", cn: "å°å®å®" }
    ];

    let vocabList = [];
    let vocabIndex = 0;
    let totalRounds = 0;
    let isCorrect = false; // æ­£è§£çŠ¶æ…‹ã‚’è¿½è·¡ã™ã‚‹å¤‰æ•°

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function resetVocabList() {
      vocabList = [...vocabListBase];
      shuffle(vocabList);
      vocabIndex = 0;
    }

    function updateProgress() {
      const counts = [0, 0, 0, 0];
      for (let word of vocabListBase) {
        const count = stats[word.cn] || 0;
        counts[count]++;
      }
      document.getElementById('count0').innerText = counts[0];
      document.getElementById('count1').innerText = counts[1];
      document.getElementById('count2').innerText = counts[2];
      document.getElementById('count3').innerText = counts[3];
      document.getElementById('countReview').innerText = 0;

      let total = counts.reduce((a,b) => a + b, 0);
      let bar = document.getElementById('barFill');
      let width = (counts[1] + 2 * counts[2] + 3 * counts[3]) / (3 * total) * 100;
      bar.style.width = width + '%';
    }

    function playVocab() {
      if (vocabList.length === 0) resetVocabList();
      const vocab = vocabList[vocabIndex].cn;
      const audioMap = {
        "åŠ¨ç‰©å›­": "åŠ¨ç‰©å›­.mp3",
        "é‡‘é±¼": "é‡‘é±¼.mp3",
        "å¯çˆ±": "å¯çˆ±.mp3",
        "ç†ŠçŒ«": "ç†ŠçŒ«.mp3",
        "å°å®å®": "å°å®å®.mp3",
        "å¤§çº¦": "å¤§çº¦.mp3",
        "å¤šå°‘": "å¤šå°‘.mp3"
      };
      const audioFile = audioMap[vocab];
      if (audioFile) {
        const audio = document.getElementById('audioPlayer');
        audio.src = audioFile;
        audio.play();
      } else {
        console.warn("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: " + vocab);
      }
      document.getElementById('answerVocab').value = '';
      document.getElementById('feedbackVocab').innerHTML = '';
      isCorrect = false; // æ–°ã—ã„å•é¡Œé–‹å§‹æ™‚ã«ãƒªã‚»ãƒƒãƒˆ
    }

    function checkVocab() {
      const input = document.getElementById('answerVocab').value.trim();
      const feedback = document.getElementById('feedbackVocab');
      const completion = document.getElementById('completionMessage');
      const currentVocab = vocabList[vocabIndex].cn;
      if (!stats[currentVocab]) stats[currentVocab] = 0;

      if (input === currentVocab) {
        stats[currentVocab] = Math.min(3, stats[currentVocab] + 1);
        feedback.innerHTML = '<span style="color:green;">æ­£è§£ã§ã™ï¼ï¼ˆEnterã§æ¬¡ã®å˜èªã‚’èãï¼‰</span>';
        isCorrect = true; // æ­£è§£çŠ¶æ…‹ã‚’è¨­å®š
        vocabIndex++;
        if (vocabIndex >= vocabList.length) {
          totalRounds++;
          if (totalRounds >= 3) {
            completion.innerHTML = '<strong>ğŸ‰ 3å‘¨æ­£è§£ã—ã¾ã—ãŸï¼ç·´ç¿’å®Œäº†ã§ã™ï¼</strong>';
            isCorrect = false; // å®Œäº†æ™‚ã¯ãƒªã‚»ãƒƒãƒˆ
          } else {
            resetVocabList();
            // æ–°ã—ã„å‘¨ãŒå§‹ã¾ã£ãŸã‚‰è‡ªå‹•çš„ã«æ¬¡ã®å˜èªã‚’å†ç”Ÿ
            setTimeout(playVocab, 100);
          }
        }
      } else {
        stats[currentVocab] = 0;
        feedback.innerHTML = '<span style="color:red;">é•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¾ã—ã‚‡ã†ã€‚</span>';
        isCorrect = false; // ä¸æ­£è§£çŠ¶æ…‹ã‚’è¨­å®š
      }
      updateProgress();
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter' || event.keyCode === 13) {
        event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚’é˜²ã
        checkVocab();
      }
    }

    function handleKeyDown(event) {
      if (event.key === 'Enter' || event.keyCode === 13) {
        event.preventDefault();
        
        if (isCorrect) {
          // æ­£è§£å¾Œã®Enterã‚­ãƒ¼ã¯æ¬¡ã®å˜èªã‚’å†ç”Ÿ
          playVocab();
        } else {
          // é€šå¸¸ã®Enterã‚­ãƒ¼ã¯ç­”ãˆåˆã‚ã›
          checkVocab();
        }
      }
    }

    // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
    document.addEventListener('DOMContentLoaded', function() {
      const answerInput = document.getElementById('answerVocab');
      answerInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter' || event.keyCode === 13) {
          event.preventDefault();
          
          if (isCorrect) {
            // æ­£è§£å¾Œã®Enterã‚­ãƒ¼ã¯æ¬¡ã®å˜èªã‚’å†ç”Ÿ
            playVocab();
          } else {
            // é€šå¸¸ã®Enterã‚­ãƒ¼ã¯ç­”ãˆåˆã‚ã›
            checkVocab();
          }
        }
      });
    });

    resetVocabList();
    updateProgress();
</script>
</body>
</html>
